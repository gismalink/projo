# Спецификация продукта: Веб-приложение для планирования проектов

## 1. Видение и цель
Сделать веб-приложение для годового планирования проектов в формате, близком к Google Sheets + Gantt:
- показывать сроки и этапы проектов,
- показывать загрузку сотрудников по дням/неделям,
- считать стоимость проекта по трудозатратам и ставкам,
- сохранить расширяемую объектную модель для следующих версий.

## 2. Границы проекта

### Входит в MVP
- Справочник сотрудников: роли, навыки, ставки, отпуска.
- Справочник ролей компании (CRUD).
- CRUD проектов.
- Годовой таймлайн проектов в стиле Gantt.
- Разворот проекта до участников и их загрузки.
- Расчет плановой стоимости проекта.
- Базовые роли доступа (Admin, PM, Viewer/Finance).

### Не входит в MVP (после запуска)
- Полный учет факта по таймшитам и анализ план/факт.
- Сложный прогноз с ML.
- Глубокие интеграции (Jira/ERP/HRIS).
- Полноценная мультивалютная логика.

## 3. Роли пользователей
1. Admin
- управляет справочниками и доступами,
- меняет системные настройки (календарь, ограничения).

2. PM
- создает проекты и планирует команду,
- редактирует сроки и назначения.

3. Viewer/Finance
- просматривает планы, загрузку и стоимость.

## 4. Доменная модель

### Базовые сущности
1. Employee (Сотрудник)
- id, fullName, email, roleId, grade, status,
- defaultCapacityHoursPerDay,
- ключевые навыки.

2. Role (Роль)
- id, name, shortName, description, level, colorHex.

3. Skill (Навык)
- id, name, category.

4. EmployeeSkill (Навык сотрудника)
- employeeId, skillId, proficiencyLevel.

5. Project (Проект)
- id, code, name, description, status, priority,
- startDate, endDate,
- links (несколько ссылок на материалы).

6. ProjectAssignment (Назначение на проект)
- projectId, employeeId,
- assignmentStartDate, assignmentEndDate,
- allocationPercent или plannedHoursPerDay,
- опционально roleOnProject.

7. Vacation (Отпуск/отсутствие)
- employeeId, startDate, endDate, type.

8. CostRate (Ставка)
- employeeId (или roleId для ставки по умолчанию),
- rateType (hourly/daily), amount, currency,
- validFrom, validTo.

9. WorkCalendar (Рабочий календарь)
- календарь страны/региона, праздники, выходные,
- стандартная длительность рабочего дня.

### Ближайшие расширения
- ProjectPhase / Milestone,
- Department / Team,
- Scenario (варианты планов A/B),
- AuditLog и ChangeSet.

## 5. Ключевые бизнес-правила
1. Суммарная загрузка сотрудника в день не должна превышать 100% (или лимит часов в день).
2. Назначение, пересекающееся с отпуском, блокируется или требует явного override.
3. Стоимость считается по ставке, действующей на конкретную дату работ.
4. При изменении дат проекта пересчитываются и валидируются назначения.
5. Удаление роли безопасное: нельзя удалить роль, если она используется, без переназначения.
6. Расчеты должны быть детерминированными и воспроизводимыми.

## 6. Основные экраны

### A) Сотрудники
- список, фильтры, сортировка,
- вкладка в UI именуется «Команда» (RU) / `Team` (EN),
- карточка сотрудника: роль, навыки, история ставок, отпуска,
- формы редактирования с валидацией.

### B) Роли
- создание/изменение/удаление роли,
- просмотр связанных сотрудников,
- безопасное удаление с миграцией на другую роль.

### C) Таймлайн проектов (главный экран)
- годовой таймлайн, по строке на проект,
- свернутый вид: полоса проекта со стартом/финишем и статусом,
- развернутый вид: участники и загрузка по дням/неделям,
- подсветка конфликтов (перегруз, пересечение с отпуском),
- сводка плановой стоимости проекта.

### D) Карточка проекта
- описание и ссылки,
- команда и обзор загрузки,
- ключевые метрики: трудозатраты, плановая стоимость, длительность.

## 7. Нефункциональные требования
1. Аудит изменений: кто и когда изменил план.
2. Импорт/экспорт: CSV/Excel для миграции из таблиц.
3. Производительность: комфортная работа при 200+ сотрудниках и 100+ проектах в год.
4. Безопасность: RBAC и защищенные API.
5. API-first подход для будущих интеграций.

## 8. Рекомендуемый стек
- Frontend: React + TypeScript.
- Backend: Node.js + NestJS.
- База данных: PostgreSQL.
- ORM: Prisma.
- Авторизация: JWT + refresh token.
- Инфраструктура (позже): Redis/BullMQ для тяжелых экспортов и фоновых задач.
- Локальный запуск: Docker Compose (app + db + redis).

## 9. Границы API (высокоуровнево)
- `auth/*`: вход, refresh, сессии.
- `employees/*`: CRUD сотрудников.
- `roles/*`: CRUD ролей.
- `skills/*`: CRUD навыков.
- `projects/*`: CRUD проектов и данные карточки проекта.
- `assignments/*`: планирование назначений и загрузки.
- `calendar/*`: рабочие дни, праздники, лимиты загрузки.
- `reports/*`: отчеты по загрузке и стоимости.

## 10. Критерии приемки MVP
1. Пользователь может создавать сотрудников, роли, проекты, назначения и отпуска.
2. Годовой таймлайн корректно показывает старт/финиш проектов.
3. Проект можно развернуть и увидеть загрузку участников.
4. Система показывает минимум два типа конфликтов:
- перегруз сотрудника,
- назначение в период отпуска.
5. Плановая стоимость проекта видна и пересчитывается после изменений назначений.
6. Ролевой доступ работает для Admin, PM и Viewer/Finance.

